/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets
*  RT Poll Client
*
*  @version: 0.1.0
*  https://github.com/foo123/RT
*
**/
!function(e,t){"use strict";t("object"==typeof exports?require("./RT.js"):e.RT)}(this,function(e){"use strict";function t(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function l(e,l,n,r,o){if(e){try{e.abort()}catch(u){}e=null}return e=e||t(),e.open("POST",l,!0),e.responseType="text",e.setRequestHeader("Content-Type","text/plain; charset=utf8"),e.overrideMimeType("text/plain; charset=utf8"),n&&i.Header.encode(n,e),e.onload=function(){var t=200!==e.status,l=t?e.statusText:e.responseText;o&&o(t,l,e.getAllResponseHeaders(),e.status,e.statusText)},e.send(r),e}var n="prototype",r=(Object[n].toString,e.Client[n]),i=e.Util;return e.Client.Poll=function o(e){var t=this;return t instanceof o?(r.constructor.call(t,e),t._interval=e.pollInterval||500,t._timer=null,t._xhr=null,void(t._queue=[])):new o(e)},e.Client.Impl.poll=e.Client.Impl.ajax=e.Client.Impl.xhr=e.Client.Impl["ajax-poll"]=e.Client.Impl["xhr-poll"]=e.Client.Poll,e.Client.Poll[n]=Object.create(r),e.Client.Poll[n].constructor=e.Client.Poll,e.Client.Poll[n]._interval=500,e.Client.Poll[n]._timer=null,e.Client.Poll[n]._xhr=null,e.Client.Poll[n].dispose=function(){var e=this;if(e._timer&&clearTimeout(e._timer),e._xhr)try{e._xhr.abort()}catch(t){}return e._timer=null,e._xhr=null,e._interval=null,e._queue=null,r.dispose.call(e)},e.Client.Poll[n]._poll=function u(e){var t=this,n=t._headers||{};n["X-RT-POLL"]=1,t._headers={},t._xhr=l(t._xhr,e,n,t._queue.shift(),function(l,n,r){r=i.Header.decode(r,!0);r["x-rt-type"];l?t.trigger("error",n):n&&t.trigger(open?"open":"message",n),t._timer=setTimeout(function(){u(e)},t._interval)})},e.Client.Poll[n].send=function(e){var t=this;return t._queue.push(e),t},e.Client.Poll[n].listen=function(e){var t=this;return t._poll(e,!0),t},e.Client.Poll[n].open=function(e){var t=this,n=t._headers||{};n["X-RT-POLL"]=1,t._headers={},t._xhr=l(t._xhr,e,n,t._queue.shift(),function(l,n,r){r=i.Header.decode(r,!0);r["x-rt-type"];l?t.trigger("error",n):n&&t.trigger(open?"open":"message",n),t._timer=setTimeout(function(){poll(e)},t._interval)})},e.Client.Poll[n].close=function(){var e=this;return e._queue=[],e},e});