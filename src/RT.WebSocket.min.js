/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets / webrtc for Node/XPCOM/JS
*  RT WebSocket Client (w/ websocket shim)
*
*  @version: 1.0.1
*  https://github.com/foo123/RT
*
**/
!function(e,t){"use strict";"object"==typeof module&&module.exports?module.exports=t.call(e,module.$deps&&module.$deps.RT||require("./RT")):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("RT_WebSocket")?define("RT_WebSocket",["module","RT"],function(n,o){return t.moduleUri=n.uri,t.call(e,o),o}):(t.call(e,e.RT)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.RT})}(this,function(e){"use strict";function t(e,t,n){var o,i,r=document.getElementsByTagName("script"),s=r[r.length-1],c=s.src.split("/").slice(0,-1).join("/"),a=document.getElementsByTagName("head")[0];e=e||"./","."===e.charAt(0)&&(e=e.slice(1),e=c+("/"==e.charAt(0)?"":"/")+e),"/"!==e.charAt(e.length-1)&&(e+="/"),window.swfobject||(o=document.createElement("script"),o.setAttribute("type","text/javascript"),o.setAttribute("language","javascript"),o.setAttribute("src",s.hasAttribute("data-swfobject")?s.getAttribute("data-swfobject"):e+"swfobject.js"),a.appendChild(o)),window.WEB_SOCKET_SWF_LOCATION=e+"WebSocketMain.swf",window.WEB_SOCKET_FORCE_FLASH=!1,window.WEB_SOCKET_DEBUG=!1,i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("language","javascript"),i.onload=i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onload=i.onreadystatechange=null,n&&n())},i.setAttribute("src",e+t),a.appendChild(i)}var n,o=this,i="prototype",r=(Object[i].toString,e.Client),s=r[i];e.Platform.XPCOM?(Components.utils["import"]("resource://gre/modules/XPCOMUtils.jsm"),XPCOMUtils.importRelative(o,"lib/ws/ws.xpcom.js"),n=o.WebSocket):e.Platform.Node?n=require("./lib/ws/ws.node.js"):(n=window.WebSocket||window.MozWebSocket||window.WebkitWebSocket,n||e.Platform.WebWorker||t("./lib/ws/","ws.flash.js",function(){n=window.WebSocket}));var c=r.WS=function a(e){var t=this;return t instanceof a?(s.constructor.call(t,e),void(t.$ws$=null)):new a(e)};return r.Impl.ws=r.Impl.websocket=r.Impl["web-socket"]=c,c[i]=Object.create(s),c[i].constructor=c,c[i].$ws$=null,c[i].dispose=function(){var e=this;return e.$ws$=null,s.dispose.call(e)},c[i].abort=function(){var e=this,t=e.$ws$;return t&&n.OPEN===t.readyState&&(t.close(),s.abort.call(e,!0)),e.$ws$=null,e},c[i].close=function(e){var t=this,o=t.$ws$;return o&&n.OPEN===o.readyState&&o.close(),s.close.call(t,e),t},c[i].send=function(e){var t=this,o=t.$ws$;return o&&n.OPEN===o.readyState&&o.send(String(e)),t},c[i].listen=function(){var t,o=this;return n||e.Platform.XPCOM||e.Platform.Node?(t=o.$ws$=new n(o.$cfg$.endpoint,o.$cfg$.protocol||null),t.addEventListener("open",function(e){o.open(e)}),t.addEventListener("close",function(e){o.close(e)}),t.addEventListener("error",function(e){o.emit("error",e)}),t.addEventListener("message",function(e){o.emit("receive",e.data)}),o):(setTimeout(function(){o.listen()},100),o)},e});