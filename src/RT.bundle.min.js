/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets
*
*  @version: 0.1.0
*  https://github.com/foo123/RT
*
**/
!function(e,t,n){"use strict";"object"==typeof exports?module.exports=n():(e[t]=n())&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}(this,"RT",function(){"use strict";function e(t){t=t||{};var r=(t.type||"default").toLowerCase();return e.Client.Impl[n](r)?new e.Client.Impl[r](t):new e.Client(t)}var t="prototype",n="hasOwnProperty",r=Object.keys,i=Object[t].toString,o=String[t].trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")};return e.VERSION="0.1.0",e.Const={CRLF:"\r\n",CRLF_RE:/(\r\n)|\r|\n/g,COOKIE_RE:/([^=]+)(?:=(.*))?/},e.Util={String:{trim:o},Base64:{encode:btoa,decode:atob},Json:{encode:JSON.stringify,decode:JSON.parse},Url:{create:function(t){if(!t)return"";var n,o,l,s,u,c,f,a,d,p=[],C=r(t),h=C.length,g=e.Util.Url.encode;for(s=0,n=h>s?[[o=C[s++],t[o]]]:[];n.length;){if(u=n.shift(),o=u[0],l=u[1],d=i.call(l),"[object Array]"===d)for(o+="[]",c=0,f=l.length;f>c;c++)n.unshift([o,l[c]]);else if("[object Object]"===d)for(a=r(l),c=0,f=a.length;f>c;c++)n.unshift([o+"["+a[c]+"]",l[a[c]]]);else p.push(g(o)+"="+g(l));!n.length&&h>s&&n.unshift([o=C[s++],t[o]])}return p.join("&")},rawencode:function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},rawdecode:function(e){return decodeURIComponent(""+e)},encode:function(t){return e.Util.Url.rawencode(t).split("%20").join("+")},decode:function(t){return e.Util.Url.rawdecode((""+t).split("+").join("%20"))}},Cookie:{create:function(e,t,n,r,i,o,l){var s=arguments.length;return{name:s>0?e:"",value:s>1?t:"",domain:s>2?n:"",path:s>3?r:"/",expires:s>4?i:new Date(Date.now()+31536e6),secure:s>5?!!o:!1,httponly:s>6?!!l:!1}},encode:function(e){if(e&&e.name){var t=String(e.name)+"="+String(e.value);return t+="; Domain="+String(e.domain),t+="; Path="+String(e.path),t+="; Expires="+String(e.expires),e.secure&&(t+="; Secure"),e.httponly&&(t+="; HttpOnly"),t}},decode:function(t){var n,r,i,o,l=e.Util.Cookie.create(),s=e.Const.COOKIE_RE,u=(""+t).split("; ");if(null!=(n=u.shift().match(s))){for(l.name=n[1],l.value=n[2],i=0,o=u.length;o>i;i++)n=u[i].match(s),null!=n&&n.length&&(r=n[1].toLowerCase(),"undefined"!=typeof l[r]&&(l[r]="string"==typeof n[2]?n[2]:!0));return"string"==typeof l.expires&&(l.expires=new Date(l.expires)),l}}},Header:{encode:function(t,n){var o="";if(!t)return n?n:o;var l,s,u,c,f,a=r(t),d=e.Const.CRLF;if(n){for(s=0,u=a.length;u>s;s++)if(l=a[s],"[object Array]"===i.call(t[l]))for(c=0,f=t[l].length;f>c;c++)n.setRequestHeader(l,t[l][c]);else n.setRequestHeader(l,t[l]);return n}for(s=0,u=a.length;u>s;s++)if(l=a[s],"[object Array]"===i.call(t[l]))for(c=0,f=t[l].length;f>c;c++)o+=d+String(t[l][c]);else o+=d+String(t[l]);return o},decode:function(t,n){var r,i,l,s,u={},c=null,f=e.Const.CRLF;if(t)for(n=!0===n,t=t.split(f),i=0,l=t.length;l>i;i++)s=t[i],r=s.split(":"),r.length>1?(c=o(r.shift()),n&&(c=c.toLowerCase()),u[c]=r.join(":")):c&&(u[c]+=f+r[0]);return u}}},e.Client=function l(t){var n=this;return n instanceof l?(n._config=t,n._event={},void(n.status=e.Client.CREATED)):new l(t)},e.Client.Impl={},e.Client.OPENED=2,e.Client.CLOSED=4,e.Client.PENDING=8,e.Client.CREATED=1,e.Client.DESTROYED=0,e.Client[t]={constructor:e.Client,status:e.Client.CREATED,_config:null,_event:null,dispose:function(){var t=this;return t.status=e.Client.DESTROYED,t._config=null,t._event=null,t},addEventListener:function(e,t){var r=this;return e&&t?(r._event[n](e)?r._event[e].push(t):r._event[e]=[t],r):r},removeEventListener:function(e,t){var r=this;if(!e||!r._event[n](e))return r;if(null==t)delete r._event[e];else{for(var i=r._event[e],o=i.length-1;o>=0;o--)i[o]===t&&t.splice(o,1);i.length||delete r._event[e]}return r},trigger:function(e,t){var r=this;if(!e||!r._event[n](e))return r;var i,o=r._event[e].slice(),l=o.length;for(i=0;l>i;i++)o[i](t);return r},open:function(){},close:function(){},send:function(){},listen:function(){}},e.Client[t].on=e.Client[t].addEventListener,e.Client[t].off=e.Client[t].removeEventListener,e});

/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets
*  RT Poll Client
*
*  @version: 0.1.0
*  https://github.com/foo123/RT
*
**/
!function(e,t){"use strict";t("object"==typeof exports?require("./RT.js"):e.RT)}(this,function(e){"use strict";function t(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}function l(e,l,n,r,o){if(e){try{e.abort()}catch(u){}e=null}return e=e||t(),e.open("POST",l,!0),e.responseType="text",e.setRequestHeader("Content-Type","text/plain; charset=utf8"),e.overrideMimeType("text/plain; charset=utf8"),n&&i.Header.encode(n,e),e.onload=function(){var t=200!==e.status,l=t?e.statusText:e.responseText;o&&o(t,l,e.getAllResponseHeaders(),e.status,e.statusText)},e.send(r),e}var n="prototype",r=(Object[n].toString,e.Client[n]),i=e.Util;return e.Client.Poll=function o(e){var t=this;return t instanceof o?(r.constructor.call(t,e),t._interval=e.pollInterval||500,t._timer=null,t._xhr=null,void(t._queue=[])):new o(e)},e.Client.Impl.poll=e.Client.Impl.ajax=e.Client.Impl.xhr=e.Client.Impl["ajax-poll"]=e.Client.Impl["xhr-poll"]=e.Client.Poll,e.Client.Poll[n]=Object.create(r),e.Client.Poll[n].constructor=e.Client.Poll,e.Client.Poll[n]._interval=500,e.Client.Poll[n]._timer=null,e.Client.Poll[n]._xhr=null,e.Client.Poll[n].dispose=function(){var e=this;if(e._timer&&clearTimeout(e._timer),e._xhr)try{e._xhr.abort()}catch(t){}return e._timer=null,e._xhr=null,e._interval=null,e._queue=null,r.dispose.call(e)},e.Client.Poll[n]._poll=function u(e){var t=this,n=t._headers||{};n["X-RT-POLL"]=1,t._headers={},t._xhr=l(t._xhr,e,n,t._queue.shift(),function(l,n,r){r=i.Header.decode(r,!0);r["x-rt-type"];l?t.trigger("error",n):n&&t.trigger(open?"open":"message",n),t._timer=setTimeout(function(){u(e)},t._interval)})},e.Client.Poll[n].send=function(e){var t=this;return t._queue.push(e),t},e.Client.Poll[n].listen=function(e){var t=this;return t._poll(e,!0),t},e.Client.Poll[n].open=function(e){var t=this,n=t._headers||{};n["X-RT-POLL"]=1,t._headers={},t._xhr=l(t._xhr,e,n,t._queue.shift(),function(l,n,r){r=i.Header.decode(r,!0);r["x-rt-type"];l?t.trigger("error",n):n&&t.trigger(open?"open":"message",n),t._timer=setTimeout(function(){poll(e)},t._interval)})},e.Client.Poll[n].close=function(){var e=this;return e._queue=[],e},e});

/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets
*  RT WebSocket Client (w/ websocket shim)
*
*  @version: 0.1.0
*  https://github.com/foo123/RT
*
**/
!function(t,e){"use strict";e("object"==typeof exports?require("./RT.js"):t.RT)}(this,function(t){"use strict";function e(t){var e,n,i=document.getElementsByTagName("scripts"),o=i[i.length-1].src.split("/").slice(0,-1).join("/"),s=document.getElementsByTagName("head")[0];window.swfobject||(e=document.createElement("script"),e.setAttribute("type","text/javascript"),e.setAttribute("language","javascript"),e.setAttribute("src",o+"/websocket/swfobject.js"),s.appendChild(e)),window.WEB_SOCKET_SWF_LOCATION=o+"/websocket/WebSocketMain.swf",window.WEB_SOCKET_FORCE_FLASH=!1,window.WEB_SOCKET_DEBUG=!1,n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.setAttribute("language","javascript"),n.setAttribute("src",o+"/websocket/web_socket.js"),n.onload=n.onreadystatechange=function(){("loaded"==n.readyState||"complete"==n.readyState)&&(n.onload=n.onreadystatechange=null,t&&t())},s.appendChild(n)}var n="prototype",i=(Object[n].toString,t.Client[n]),o=(t.Util,window.WebSocket||window.MozWebSocket);return o||e(function(){o=window.WebSocket}),t.Client.WS=function s(t){var e=this;return e instanceof s?(i.constructor.call(e,t),void(e._ws=null)):new s(t)},t.Client.Impl.ws=t.Client.Impl.websocket=t.Client.Impl["web-socket"]=t.Client.WS,t.Client.WS[n]=Object.create(i),t.Client.WS[n].constructor=t.Client.WS,t.Client.WS[n]._ws=null,t.Client.WS[n].dispose=function(){var t=this;return t._ws=null,i.dispose.call(t)},t});

/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets
*  RT BOSH Client
*
*  @version: 0.1.0
*  https://github.com/foo123/RT
*
**/
!function(t,n){"use strict";n("object"==typeof exports?require("./RT.js"):t.RT)}(this,function(t){"use strict";{var n="prototype",e=(Object[n].toString,t.Client[n]);t.Util}return t.Client.BOSH=function r(t){var n=this;return n instanceof r?(e.constructor.call(n,t),void(n._xhr=null)):new r(t)},t.Client.Impl.bosh=t.Client.BOSH,t.Client.BOSH[n]=Object.create(e),t.Client.BOSH[n].constructor=t.Client.BOSH,t.Client.BOSH[n]._xhr=null,t.Client.BOSH[n].dispose=function(){var t=this;if(t._xhr)try{t._xhr.abort()}catch(n){}return t._xhr=null,e.dispose.call(t)},t});
