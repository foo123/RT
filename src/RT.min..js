/**
*  RT
*  unified client-side real-time communication using (xhr) polling / bosh / (web)sockets
*
*  @version: 0.1.0
*  https://github.com/foo123/RT
*
**/
!function(e,t,n){"use strict";"object"==typeof exports?module.exports=n():(e[t]=n())&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}(this,"RT",function(){"use strict";function e(t){t=t||{};var r=(t.rt_type||"default").toLowerCase();return e.Client.Impl[n](r)?new e.Client.Impl[r](t):new e.Client(t)}var t="prototype",n="hasOwnProperty",r=Object.keys,o=Object[t].toString,i=String.fromCharCode,a=/^\s+|\s+$/g,l=String[t].trim?function(e){return e.trim()}:function(e){return e.replace(a,"")},u=/[^A-Za-z0-9\+\/\=]/g,c=/\x0d\x0a/g,s=window.XMLHttpRequest?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")},f=0;return e.VERSION="0.1.0",e.XHR={create:function(t,n){t=t||{};var r=s(),o=!0;return r._abort=r.abort,r._aborted=!1,r.abort=function(e){if(!r._aborted){!1===e&&(o=!1);try{r._abort()}catch(t){}r._aborted=!0,o=!0}},r.__headers__=null,r.responseHeader=function(e){return null==e||4!==r.readyState?null:r.getResponseHeader(e)},r.responseHeaders=function(t){if(4!==r.readyState)return null;var n=r.getAllResponseHeaders()||"";return null==r.__headers__&&(r.__headers__=e.Util.Header.decode(n)),!0===t?r.__headers__:n},t.url?(r.open(t.method||"GET",t.url,!t.sync),r.responseType=t.responseType||"text",t.headers&&e.Util.Header.encode(t.headers,r),t.mimeType&&r.overrideMimeType(t.mimeType),r.timeout=t.timeout||3e4,t.onProgress&&(r.onprogress=function(){t.onProgress(r)}),t.onLoadStart&&(r.onloadstart=function(){t.onLoadStart(r)}),t.onLoadEnd&&(r.onloadend=function(){t.onLoadEnd(r)}),!t.sync&&t.onStateChange&&(r.onreadystatechange=function(){t.onStateChange(r)}),r.onload=function(){4===r.readyState&&(200===r.status?t.onComplete&&t.onComplete(r):t.onRequestError?t.onRequestError(r):t.onError&&t.onError(r))},r.onabort=function(){o&&t.onAbort&&t.onAbort(r)},r.onerror=function(){t.onError&&t.onError(r)},r.ontimeout=function(){t.onTimeout&&t.onTimeout(r)},arguments.length>1&&r.send(n),r):r}},e.UUID=function(e,t){return(e||"")+ ++f+"_"+Date.now()+"_"+Math.floor(1e3*Math.random())+(t||"")},e.Const={BASE64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",CRLF:"\r\n",CRLF_RE:/(\r\n)|\r|\n/g,COOKIE_RE:/([^=]+)(?:=(.*))?/},e.Util={String:{trim:l},Utf8:{encode:function(e){e=e.replace(c,"\n");var t,n,r,o="";for(t=0,n=e.length;n>t;t++)r=e.charCodeAt(t),o+=128>r?i(r):r>127&&2048>r?i(r>>6|192)+i(63&r|128):i(r>>12|224)+i(r>>6&63|128)+i(63&r|128);return o},decode:function(e){for(var t="",n=0,r=c1=c2=0,o=e.length;o>n;)r=e.charCodeAt(n),128>r?(t+=i(r),n++):r>191&&224>r?(c2=e.charCodeAt(n+1),t+=i((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=i((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}},Base64:{encode:function(t){t=e.Util.Utf8.encode(t);for(var n,r,o,i,a,l,u,c="",s=0,f=t.length,d=e.Const.BASE64;f>s;)n=t.charCodeAt(s++),r=t.charCodeAt(s++),o=t.charCodeAt(s++),i=n>>2,a=(3&n)<<4|r>>4,l=(15&r)<<2|o>>6,u=63&o,isNaN(r)?l=u=64:isNaN(o)&&(u=64),c=c+d.charAt(i)+d.charAt(a)+d.charAt(l)+d.charAt(u);return c},decode:function(t){t=t.replace(u,"");for(var n,r,o,a,l,c,s,f="",d=0,h=t.length;h>d;)a=keyString.indexOf(t.charAt(d++)),l=keyString.indexOf(t.charAt(d++)),c=keyString.indexOf(t.charAt(d++)),s=keyString.indexOf(t.charAt(d++)),n=a<<2|l>>4,r=(15&l)<<4|c>>2,o=(3&c)<<6|s,f+=i(n),64!=c&&(f+=i(r)),64!=s&&(f+=i(o));return f=e.Util.Utf8.decode(f)}},Json:{encode:JSON.stringify,decode:JSON.parse},Url:{create:function(t){if(!t)return"";var n,i,a,l,u,c,s,f,d,h=[],g=r(t),p=g.length,C=e.Util.Url.encode;for(l=0,n=p>l?[[i=g[l++],t[i]]]:[];n.length;){if(u=n.shift(),i=u[0],a=u[1],d=o.call(a),"[object Array]"===d)for(i+="[]",c=0,s=a.length;s>c;c++)n.unshift([i,a[c]]);else if("[object Object]"===d)for(f=r(a),c=0,s=f.length;s>c;c++)n.unshift([i+"["+f[c]+"]",a[f[c]]]);else h.push(C(i)+"="+C(a));!n.length&&p>l&&n.unshift([i=g[l++],t[i]])}return h.join("&")},rawencode:function(e){return encodeURIComponent(""+e).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")},rawdecode:function(e){return decodeURIComponent(""+e)},encode:function(t){return e.Util.Url.rawencode(t).split("%20").join("+")},decode:function(t){return e.Util.Url.rawdecode((""+t).split("+").join("%20"))}},Cookie:{create:function(e,t,n,r,o,i,a){var l=arguments.length;return{name:l>0?e:"",value:l>1?t:"",domain:l>2?n:"",path:l>3?r:"/",expires:l>4?o:new Date(Date.now()+31536e6),secure:l>5?!!i:!1,httponly:l>6?!!a:!1}},encode:function(e){if(e&&e.name){var t=String(e.name)+"="+String(e.value);return t+="; Domain="+String(e.domain),t+="; Path="+String(e.path),t+="; Expires="+String(e.expires),e.secure&&(t+="; Secure"),e.httponly&&(t+="; HttpOnly"),t}},decode:function(t){var r,o,i,a,l=e.Util.Cookie.create(),u=e.Const.COOKIE_RE,c=String(t).split("; ");if(null!=(r=c.shift().match(u))){for(l.name=r[1],l.value=r[2],i=0,a=c.length;a>i;i++)r=c[i].match(u),null!=r&&r.length&&(o=r[1].toLowerCase(),l[n](o)&&(l[o]="string"==typeof r[2]?r[2]:!0));return"string"==typeof l.expires&&(l.expires=new Date(l.expires)),l}}},Header:{encode:function(t,n,i){var a="";if(!t)return xhr?xhr:a;var l,u,c,s,f,d=r(t),h=e.Const.CRLF;if(i){for(u=0,c=d.length;c>u;u++)l=d[u],i.setHeader(l,t[l]);return i}if(n){for(u=0,c=d.length;c>u;u++)if(l=d[u],"[object Array]"===o.call(t[l]))for(s=0,f=t[l].length;f>s;s++)n.setRequestHeader(l,t[l][s]);else n.setRequestHeader(l,t[l]);return n}for(u=0,c=d.length;c>u;u++)if(l=d[u],"[object Array]"===o.call(t[l]))for(s=0,f=t[l].length;f>s;s++)a+=h+String(t[l][s]);else a.length&&(a+=h),a+=l+": "+String(t[l]);return a},decode:function(t,r){var o,i,a,u,c={},s=null,f=e.Const.CRLF;if(t)for(r=!0===r,t=t.split(f),i=0,a=t.length;a>i;i++)u=t[i],o=u.split(":"),o.length>1?(s=l(o.shift()),r&&(s=s.toLowerCase()),c[n](s)?("string"==typeof c[s]&&(c[s]=[c[s]]),c[s].push(l(o.join(":")))):c[s]=l(o.join(":"))):o[0].length&&s&&(c[s]=f+o[0]);return c}}},e.Client=function d(t){var n=this;return n instanceof d?(n.$cfg$=t||{},n.$event$={},void(n.status=e.Client.CREATED)):new d(t)},e.Client.Impl={},e.Client.CREATED=1,e.Client.DESTROYED=0,e.Client.OPENED=2,e.Client.CLOSED=4,e.Client.PENDING=8,e.Client[t]={constructor:e.Client,status:e.Client.CREATED,$cfg$:null,$event$:null,dispose:function(){var t=this;return t.status=e.Client.DESTROYED,t.$cfg$=null,t.$event$=null,t},config:function(e,t){var n=this,r=n.$cfg$;return e?arguments.length>1?(r[e]=t,n):r[e]:void 0},on:function(e,t,r){var o=this;return e&&t?(o.$event$[n](e)?o.$event$[e].push([t,!0===r,0]):o.$event$[e]=[[t,!0===r,0]],o):o},one:function(e,t){return this.on(e,t,!0)},off:function(e,t){var r=this;if(!e||!r.$event$[n](e))return r;if(null==t)delete r.$event$[e];else{for(var o=r.$event$[e],i=o.length-1;i>=0;i--)o[i][0]===t&&t.splice(i,1);o.length||delete r.$event$[e]}return r},emit:function(e,t){var r=this;if(!e||!r.$event$[n](e))return r;var o,i,a=r.$event$[e].slice(),l=a.length,u=[],c={event:e,data:t,target:r};for(o=0;l>o;o++)i=a[o],i[1]&&u.push(o),i[1]&&i[2]||(i[2]=1,i[0](c));for(a=r.$event$[e],o=u.length-1;o>=0;o--)a.splice(u[o],1);return a.length||delete r.$event$[e],r},abort:function(e){return!0===e?this.emit("abort"):this},open:function(){return this.emit("open")},close:function(){return this.abort(!1).emit("close")},send:function(){return this},listen:function(){return this}},e.Client[t].addEventListener=e.Client[t].on,e.Client[t].removeEventListener=e.Client[t].off,e.Client[t].trigger=e.Client[t].dispatchEvent=e.Client[t].emit,e});